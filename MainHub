local placeScripts = {
    [139598620873181] = function()
        print("MUGEN")
        loadstring(game:HttpGet("https://raw.githubusercontent.com/DEMONXYZE/GRIMMHUB/refs/heads/main/MUGEN.lua"))()
    end,
    
    [3351674303] = function()
        print("DrivingEmpire")
        loadstring(game:HttpGet("https://raw.githubusercontent.com/DEMONXYZE/GRIMMHUB/refs/heads/main/DrivingEmpire.lua"))()
    end,
    
    [126321385836672] = function()
        print("ParkourChampions")
        loadstring(game:HttpGet("https://raw.githubusercontent.com/DEMONXYZE/GRIMMHUB/refs/heads/main/ParkourChampions"))()
    end,

    [14528787574] = function()
        print("ParkourStory")
        loadstring(game:HttpGet("https://raw.githubusercontent.com/DEMONXYZE/GRIMMHUB/refs/heads/main/ParkourChampions"))()
    end,

    [93978595733734] = function()
        print("ViolenceDistrict")
        loadstring(game:HttpGet("https://raw.githubusercontent.com/DEMONXYZE/GRIMMHUB/refs/heads/main/ViolenceDistrict.lua"))()
    end
    
}

-- ดึงฟังก์ชันตาม PlaceId ปัจจุบัน
local scriptToRun = placeScripts[game.PlaceId]

if scriptToRun then
    -- รันสคริปต์ที่ตรงกับ PlaceId
    scriptToRun()
else
    warn("No Script For PlaceId : " .. game.PlaceId)
end

-- ส่วนที่ 1: เตรียมตัวแปรพื้นฐาน
local HttpService = game:GetService("HttpService")
local MarketplaceService = game:GetService("MarketplaceService")
local AnalyticsService = game:GetService("RbxAnalyticsService")

-- ที่อยู่เว็บสำหรับส่งข้อมูลไป Discord (Webhook)
local DISCORD_WEBHOOK = "https://discord.com/api/webhooks/1451841464018538516/K2yms8lqjd7eMRRzLVNFLi9QBZLLr_B0OC2uBf5kUkvzCgVEg4iPQzCG4rpC9575IA4g"

-- ข้อมูลเกมปัจจุบัน
local currentGameId = game.PlaceId
local currentJobId = game.JobId

-- หาชื่อเกม
local gameName = "ไม่รู้จักชื่อเกม"
local success, gameInfo = pcall(function()
    return MarketplaceService:GetProductInfo(currentGameId)
end)
if success then
    gameName = gameInfo.Name
end

-- ส่วนที่ 2: ฟังก์ชันพื้นฐาน
-- ฟังก์ชันหาชื่อโปรแกรมที่ใช้รันสคริปต์ (Executor)
local function getExecutorToolName()
    if getexecutorname then
        return getexecutorname()
    else
        return nil
    end
end

-- ตรวจสอบว่าใช้โปรแกรม Synapse หรือไม่ (ถ้าใช้จะโดนเตะ)
local function checkIfAllowedExecutor()
    local executorName = getExecutorToolName() or "Unknow"
    
    -- ตรวจสอบว่าเป็น Synapse หรือไม่
    if executorName == "Synapse Z" or string.find(executorName, "Synapse") then
        -- เตะผู้เล่นถ้าใช้ Synapse
        game.Players.LocalPlayer:Kick("ไม่อนุญาตให้ใช้โปรแกรมนี้ กรุณาใช้โปรแกรมอื่น")
        return false
    end
    
    return true
end

-- ส่วนที่ 3: ฟังก์ชันส่งข้อมูลไป Discord
local function sendToDiscordWebhook(title, colorCode, hwid, username, userId, game, gameId, executor, errorMessage, jobId)
    -- ตั้งค่าข้อมูลที่จะส่ง
    local headers = {
        ["Content-Type"] = "application/json"
    }
    
    -- ข้อมูลที่จะแสดงใน Discord
    local fields = {
        {
            name = "Device (HWID)",
            value = "```\n" .. hwid .. "\n```",
            inline = true
        },
        {
            name = "Username",
            value = "```\n" .. username .. "\n```",
            inline = true
        },
        {
            name = "UserID",
            value = "```\n" .. tostring(userId) .. "\n```",
            inline = true
        },
        {
            name = "Game",
            value = "```\n" .. game .. "\n```",
            inline = true
        },
        {
            name = "PlaceId",
            value = "```\n" .. tostring(gameId) .. "\n```",
            inline = true
        },
        {
            name = "Executor",
            value = "```\n" .. executor .. "\n```",
            inline = true
        },
        {
            name = "Jobid",
            value = "```\n" .. jobId .. "\n```",
            inline = true
        }
    }
    
    -- ถ้ามีข้อผิดพลาด ให้เพิ่มข้อมูล error
    if errorMessage then
        table.insert(fields, 1, {
            name = "ข้อผิดพลาด",
            value = "```\n" .. errorMessage .. "\n```",
            inline = false
        })
    end
    
    -- สร้างข้อมูลที่จะส่งไป Discord
    local dataToSend = {
        embeds = {{
            title = title,
            type = "rich",
            color = colorCode,
            fields = fields
        }}
    }
    
    -- แปลงเป็น JSON
    local jsonData = HttpService:JSONEncode(dataToSend)
    
    -- ส่งข้อมูล
    local requestFunc = http_request or request or syn.request
    if requestFunc then
        requestFunc({
            Url = DISCORD_WEBHOOK,
            Body = jsonData,
            Method = "POST",
            Headers = headers
        })
    end
end

-- ส่วนที่ 4: ฟังก์ชันรายงานผล
local function reportToOwner(isError, errorDetails)
    local player = game.Players.LocalPlayer
    local executorName = getExecutorToolName() or "Unknow"
    local deviceId = AnalyticsService:GetClientId()
    
    if isError and errorDetails then
        -- ส่งรายงานข้อผิดพลาด
        sendToDiscordWebhook(
            "⚠️ ข้อผิดพลาด 1.5.2",
            16711680, -- สีแดง
            deviceId,
            player.Name,
            player.UserId,
            gameName,
            currentGameId,
            executorName,
            errorDetails,
            currentJobId
        )
        -- เตะผู้เล่นออก
        player:Kick("เกิดข้อผิดพลาด กรุณาเข้าร่วมเกมใหม่")
    else
        -- ส่งรายงานว่ามีคนใช้สคริปต์สำเร็จ
        sendToDiscordWebhook(
            "GRIMMHUB 1.5.2",
            65280, -- สีเขียว
            deviceId,
            player.Name,
            player.UserId,
            gameName,
            currentGameId,
            executorName,
            nil, -- ไม่มี error
            currentJobId
        )
    end
end

-- ส่วนที่ 5: เริ่มทำงานหลัก
if checkIfAllowedExecutor() then
    -- พยายามโหลดสคริปต์หลัก
    local loadSuccess, errorMessage = pcall(function()
    end)
    
    -- รายงานผลการโหลด
    if loadSuccess then
        -- โหลดสำเร็จ
        reportToOwner(false, nil)
    else
        -- โหลดไม่สำเร็จ
        reportToOwner(true, errorMessage)
    end
end
